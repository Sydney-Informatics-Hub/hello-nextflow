
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../04_multiqc/">
      
      
        <link rel="next" href="../../resources/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.36">
    
    
      
        <title>2.5 Upscaling to multiple samples and introspection - Hello Nextflow</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.06209087.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-TNWWV3HK57"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-TNWWV3HK57",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-TNWWV3HK57",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#25-productionising-our-workflow" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Hello Nextflow" class="md-header__button md-logo" aria-label="Hello Nextflow" data-md-component="logo">
      
  <img src="../../assets/usyd-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Hello Nextflow
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2.5 Upscaling to multiple samples and introspection
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Sydney-Informatics-Hub/hello-nextflow" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Sydney-Informatics-Hub/hello-nextflow
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Hello Nextflow" class="md-nav__button md-logo" aria-label="Hello Nextflow" data-md-component="logo">
      
  <img src="../../assets/usyd-logo.png" alt="logo">

    </a>
    Hello Nextflow
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Sydney-Informatics-Hub/hello-nextflow" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Sydney-Informatics-Hub/hello-nextflow
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Part 1
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Part 1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/00_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.0 Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/01_hellonextflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.1 Why Nextflow?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/02_helloworld/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.2 Hello World!
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/03_hellonf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.3 Your first pipeline
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/04_output/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.4 Outputs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/05_inputs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.5 Inputs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/06_params/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.6 Parameters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/07_process/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.7 Adding processes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/08_dynamic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.8 Dynamic naming
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Part 2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Part 2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../00_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.0 Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_salmon_idx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.1 Our first process and container
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02_fastqc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.2 Samplesheets, operators, and groovy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03_quant/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.3 Multiple process inputs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04_multiqc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.4 Combining channels, multiple process outputs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    2.5 Upscaling to multiple samples and introspection
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    2.5 Upscaling to multiple samples and introspection
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#251-labeling-tasks-with-the-tag-directive" class="md-nav__link">
    <span class="md-ellipsis">
      2.5.1 Labeling tasks with the tag directive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#252-using-a-samplesheet-with-multiple-samples" class="md-nav__link">
    <span class="md-ellipsis">
      2.5.2 Using a samplesheet with multiple samples
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#253-an-introduction-to-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      2.5.3 An introduction to configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#254-inspecting-workflow-performance" class="md-nav__link">
    <span class="md-ellipsis">
      2.5.4 Inspecting workflow performance
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Supporting materials
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#251-labeling-tasks-with-the-tag-directive" class="md-nav__link">
    <span class="md-ellipsis">
      2.5.1 Labeling tasks with the tag directive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#252-using-a-samplesheet-with-multiple-samples" class="md-nav__link">
    <span class="md-ellipsis">
      2.5.2 Using a samplesheet with multiple samples
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#253-an-introduction-to-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      2.5.3 An introduction to configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#254-inspecting-workflow-performance" class="md-nav__link">
    <span class="md-ellipsis">
      2.5.4 Inspecting workflow performance
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="25-productionising-our-workflow">2.5 Productionising our workflow</h1>
<div class="admonition note">
<p class="admonition-title">Learning objectives</p>
<ol>
<li>Configure Nextflow workflows to run on multiple samples</li>
<li>Enable and interpret Nextflow's inbuilt reports </li>
<li>Implement the <code>tag</code> directive to label tasks for better tracking and profiling</li>
<li>Configure a Nextflow workflow to use multiple CPUs for a process </li>
</ol>
</div>
<p>Now that we have a working pipeline on a single-sample, we will update it 
to take multiple samples and introduce Nextflow concepts that not only help with understanding and profiling the pipeline but also set the stage for productionising it. </p>
<p>We will focus on making the workflow scalable, robust, and efficient for real-world data processing. Key productionisation practices include: </p>
<ul>
<li>Automating tasks</li>
<li>Handling errors gracefully</li>
<li>Optimising resource usage</li>
<li>Ensuring reproducibility. </li>
</ul>
<p>These steps ensure that the pipeline can be reliably used in more complex scenarios, like when processing multiple samples in parallel. </p>
<h2 id="251-labeling-tasks-with-the-tag-directive">2.5.1 Labeling tasks with the <code>tag</code> directive</h2>
<p>The <a href="https://www.nextflow.io/docs/latest/process.html#tag">tag</a> process
directive allows you to add a custom label, or tag, to each task that gets
executed. It is useful for identifying what is being run when the workflow
is being executed in a bit more detail. It is especially helpful showing you 
what is being run when we run multiple samples, and for profiling later.</p>
<p>Add the following <code>tag</code> directives to your existing <code>FASTQC</code> and
<code>QUANTIFICATION</code> processes. </p>
<p>For <code>FASTQC</code>:</p>
<div class="highlight"><span class="filename">main.nf</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">process</span><span class="w"> </span><span class="n">FASTQC</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="hll"><span class="w">    </span><span class="n">tag</span><span class="w"> </span><span class="s2">&quot;fastqc on ${sample_id}&quot;</span>
</span><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="n">container</span><span class="w"> </span><span class="s2">&quot;quay.io/biocontainers/fastqc:0.12.1--hdfd78af_0&quot;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="n">publishDir</span><span class="w"> </span><span class="s2">&quot;results&quot;</span><span class="o">,</span><span class="w"> </span><span class="nl">mode:</span><span class="w"> </span><span class="s1">&#39;copy&#39;</span>
</code></pre></div>
<p>And for <code>QUANTIFICATION</code>:  </p>
<div class="highlight"><span class="filename">main.nf</span><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">process</span><span class="w"> </span><span class="n">QUANTIFICATION</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="hll"><span class="w">    </span><span class="n">tag</span><span class="w"> </span><span class="s2">&quot;salmon on ${sample_id}&quot;</span>
</span><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="n">container</span><span class="w"> </span><span class="s2">&quot;quay.io/biocontainers/salmon:1.10.1--h7e5ed60_0&quot;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="n">publishDir</span><span class="w"> </span><span class="s2">&quot;results&quot;</span><span class="o">,</span><span class="w"> </span><span class="nl">mode:</span><span class="w"> </span><span class="s1">&#39;copy&#39;</span>
</code></pre></div>
<p>The tags we just added indicates what program is being run (<code>fastqc</code> or 
<code>salmon</code>), and on which sample (<code>${sample_id}</code>) it is being run on. </p>
<p>Run the pipeline with the updated tags:  </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf<span class="w"> </span>-resume
</code></pre></div>
<p>The output should look similar to:  </p>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="go">Launching `main.nf` [distraught_bell] DSL2 - revision: dcb06191e7</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="go">executor &gt;  local (5)</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="go">[aa/3b8821] INDEX                           | 1 of 1, cached: 1 ✔</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="go">[c2/baa069] FASTQC (fastqc on gut)          | 1 of 1, cached: 1 ✔</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="go">[ad/e49b20] QUANTIFICATION (salmon on gut)  | 1 of 1, cached: 1 ✔</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="go">[a3/1f885c] MULTIQC                         | 1 of 1, cached: 1 ✔</span>
</code></pre></div>
<p>No new tasks were run, but <code>FASTQC</code> and <code>QUANTIFICATION</code> processes now have
labels appended in the execution output.  </p>
<h2 id="252-using-a-samplesheet-with-multiple-samples">2.5.2 Using a samplesheet with multiple samples</h2>
<p>Recall that the samplesheet is used to control which files/data are analysed by
the workflow. Inspect <code>data/samplesheet_full.csv</code>.  </p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">samplesheet_full.csv</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="go">sample,fastq_1,fastq_2</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="go">gut,data/ggal/gut_1.fq,data/ggal/gut_2.fq</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="go">liver,data/ggal/liver_1.fq,data/ggal/liver_2.fq</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="go">lung,data/ggal/lung_1.fq,data/ggal/lung_2.fq</span>
</code></pre></div></td></tr></table></div>
<p>Compared to the samplesheet we have been using <code>data/samplesheet.csv</code>, this one
contains two additional lines for the <code>liver</code> and <code>lung</code> paired reads.</p>
<p>Next we will run the workflow with all three samples by overwriting the default 
input for <code>reads</code> with <code>data/samplesheet_full.csv</code> using the double hyphen 
approach <code>--reads</code> in the run command.</p>
<p>Run the workflow:  </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf<span class="w"> </span>-resume<span class="w"> </span>--reads<span class="w"> </span>data/samplesheet_full.csv
</code></pre></div>
<p>Your output should look similar to:  </p>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="go">Launching `main.nf` [distraught_bell] DSL2 - revision: dcb06191e7</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="go">executor &gt;  local (5)</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="go">[de/fef8c4] INDEX                           | 1 of 1, cached: 1 ✔</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="go">[4e/b4c797] FASTQC (fastqc on liver)        | 3 of 3, cached: 1 ✔</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="go">[36/93c8b4] QUANTIFICATION (salmon on lung) | 3 of 3, cached: 1 ✔</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="go">[e7/5d91ea] MULTIQC                         | 1 of 1 ✔</span>
</code></pre></div>
<p>There are two new tasks run for <code>FASTQC</code> and <code>QUANTIFICATION</code>. Our newly added
tags indicate which samples they were run on - either <code>lung</code> or <code>liver</code> reads!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Updating the <code>params.reads</code> definition in your <code>main.nf</code> script can save
having to add the <code>--reads</code> flag every time you want to run it with a
different samplesheet.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Advanced Exercise</p>
<ol>
<li>Update the workflow scope to inspect the output of the <code>reads_in</code> channel (i.e. with <code>.view()</code>)</li>
<li>Run the workflow with <code>samplesheet_full.csv</code></li>
</ol>
<p>What has changed with what the <code>reads_in</code> channel is emitting?</p>
<details class="note">
<summary>Solution</summary>
<p>Viewing <code>reads_in</code>: </p>
<div class="highlight"><span class="filename">main.nf</span><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="w">    </span><span class="c1">// Define the fastqc input channel</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="n">reads_in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="n">params</span><span class="o">.</span><span class="na">reads</span><span class="o">)</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">[</span><span class="n">row</span><span class="o">.</span><span class="na">sample</span><span class="o">,</span><span class="w"> </span><span class="n">file</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">fastq_1</span><span class="o">),</span><span class="w"> </span><span class="n">file</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">fastq_2</span><span class="o">)]</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="hll"><span class="w">    </span><span class="n">reads_in</span><span class="o">.</span><span class="na">view</span><span class="o">()</span>
</span><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">    </span><span class="c1">// Run the fastqc step with the reads_in channel</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">    </span><span class="n">FASTQC</span><span class="o">(</span><span class="n">reads_in</span><span class="o">)</span>
</code></pre></div>
<p>Run the workflow:  </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf<span class="w"> </span>-resume<span class="w"> </span>--reads<span class="w"> </span>data/samplesheet_full.csv
</code></pre></div>
<p>Your output should look something like:  </p>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="go">executor &gt;  local (5)</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="go">[de/fef8c4] INDEX                           | 1 of 1, cached: 1 ✔</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="go">[4e/b4c797] FASTQC (fastqc on liver)        | 3 of 3, cached: 3 ✔</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="go">[36/93c8b4] QUANTIFICATION (salmon on lung) | 3 of 3, cached: 3 ✔</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="go">[e7/5d91ea] MULTIQC                         | 1 of 1 ✔</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="go">[gut, .../data/ggal/gut_1.fq, .../data/ggal/gut_2.fq]</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="go">[liver, .../data/ggal/liver_1.fq, .../data/ggal/liver_2.fq]</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="go">[lung, .../data/ggal/lung_1.fq, .../data/ggal/lung_2.fq]</span>
</code></pre></div>
<p>There are now a total of three tuples emitted separately for each sample. 
When passed into <code>FASTQC</code> and <code>QUANTIFICATION</code>, each tuple is processed
separately in independent tasks.</p>
<p>Remove <code>reads_in.view()</code> before proceeding.</p>
</details>
</div>
<h2 id="253-an-introduction-to-configuration">2.5.3 An introduction to configuration</h2>
<p>In this section, we will explore how Nextflow workflows can be configured
to utilise the computational resources available. Whilst there are many ways
to configure Nextflow workflows (especially on HPC clusters), we will focus on
increasing the number of CPUs used to speed up tasks.  </p>
<p>Some bioinformatics tool, like FastQC, support multithreading to speed up
analyses. From the <code>fastqc --help</code> command, you'll notice the following option:</p>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="go">-t --threads    Specifies the number of files which can be processed    </span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="go">                simultaneously.</span>
</code></pre></div>
<p>This means we can configure the number of threads (or CPUs) that FastQC uses
to process multiple files in parallel to speed up the analysis. In Nextflow,
we control this through the 
<a href="https://www.nextflow.io/docs/latest/process.html#cpus"><code>cpus</code></a> directive.</p>
<p>Recall that our <code>FASTQC</code> takes as input the <code>reads_in</code> channel which emits two
<code>.fastq</code> files. We will configure the process to use 2 CPUs so each file gets
run on 1 CPU each (the maximum CPUs fastqc will use per file), simulataneously.</p>
<p>In your <code>main.nf</code> script, update the <code>script</code> definition in the <code>FASTQC</code> process
to add the multithreading option:  </p>
<div class="highlight"><span class="filename">main.nf</span><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="w">    </span><span class="nl">script:</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="s2">    mkdir fastqc_${sample_id}_logs</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="hll"><span class="s2">    fastqc --outdir &quot;fastqc_${sample_id}_logs&quot; -f fastq $reads_1 $reads_2 -t $task.cpus</span>
</span><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="s2">    &quot;&quot;&quot;</span>
</code></pre></div>
<ul>
<li>The <strong><code>task.cpus</code></strong> variable is automatically populated with the number of 
CPUs allocated to the task based on the Nextflow configuration. By default this
is 1.  </li>
</ul>
<p>Next, we need to update our <code>nextflow.config</code> file to configure the number of
CPUs to be used. To allow each FastQC process to use 2 CPUs, update the
config file as follows:  </p>
<div class="highlight"><span class="filename">nextflow.config</span><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="hll"><span class="n">process</span><span class="o">.</span><span class="na">cpus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
</span><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">docker</span><span class="o">.</span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</code></pre></div>
<p>The <code>-t $task.cpus</code> argument will populate as <code>-t 2</code> when we run the workflow next.
Before we do, we will explore Nextflow's built-in reporting system to assess resource usage.</p>
<h2 id="254-inspecting-workflow-performance">2.5.4 Inspecting workflow performance</h2>
<p>When running workflows, it is helpful to understand how each part of your
workflow is using resources like CPUs, memory, and the time taken to complete.
Nextflow can generate text-based and visual reports that give you clear picture
of how your workflow ran and identify areas for improvement.  </p>
<p>We will explore some of Nextflow's built-it in tools that can show these
important details of how tasks ran.</p>
<p>To enable these reports, add the following to your <code>nextflow.config</code> file:</p>
<div class="highlight"><span class="filename">nextflow.config</span><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">process</span><span class="o">.</span><span class="na">cpus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">docker</span><span class="o">.</span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="hll"><span class="c1">// enable reporting</span>
</span><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="hll"><span class="n">dag</span><span class="o">.</span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="hll"><span class="n">report</span><span class="o">.</span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="hll"><span class="n">timeline</span><span class="o">.</span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="hll"><span class="n">trace</span><span class="o">.</span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span></code></pre></div>
<p>Run the workflow. To assess the resource usage all processes need to be run
again so <code>-resume</code> should not be used. (If we resume now, it will still
appear as a cached run, with limited information).  </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf<span class="w"> </span>--reads<span class="w"> </span><span class="s2">&quot;data/samplesheet_full.csv&quot;</span>
</code></pre></div>
<p>Inspect your project directory. You should have 3 <code>.html</code> files and a <code>.txt</code>
file with matching timestamps. A summary of the different reports are included
in the table below. For a detailed description of each report see the Nextflow
documentation on <a href="https://www.nextflow.io/docs/latest/tracing.html">reports</a>.</p>
<table>
<thead>
<tr>
<th>Report type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dag</code></td>
<td>A high-level graph that shows how processes and channels are connected to each other.</td>
</tr>
<tr>
<td><code>report</code></td>
<td>A visual summary of the time and resources used grouped by process.</td>
</tr>
<tr>
<td><code>timeline</code></td>
<td>A Gannt chart that shows when each task started and ended.</td>
</tr>
<tr>
<td><code>trace</code></td>
<td>A detailed text log with the time and resources used by each task.</td>
</tr>
</tbody>
</table>
<p>Complete the following steps in the exercise to view the report file <code>report-*.html</code> in your local browser.  </p>
<div class="admonition question">
<p class="admonition-title">Exercise</p>
<ol>
<li>In the VSCode file explorer sidebar, locate the report file (e.g. <code>report-*.html</code>)</li>
<li>Right click on the file and select <strong>"Download"</strong> to save it to your local computer.</li>
<li>Open the <code>report-*.html</code> in a browser.</li>
<li>Navigate to <strong>"Resource Usage" -&gt; "CPU"</strong>.</li>
<li>Hover over the <code>FASTQC</code> bar chart and note the <code>mean</code> CPU usage.</li>
</ol>
<div class="admonition quote">
<p class="admonition-title">Poll</p>
<p>What was the <code>mean</code> CPU usage for your <code>FASTQC</code> process?</p>
</div>
<details class="note">
<summary>Solution</summary>
<p>In this report, a mean of 2.53 CPUs were utilised by the <code>FASTQC</code> process
across the 3 samples. This value will slightly differ across runs.</p>
<p><img alt="" src="../img/report_cpu.png" /></p>
</details>
</div>
<p>You have successfully run, configured, and profiled a multi-sample workflow!</p>
<div class="admonition abstract">
<p class="admonition-title">Summary</p>
<p>In this lesson you have learned:</p>
<ol>
<li>How to add custom labels with process tags</li>
<li>How to use <code>task.cpus</code> to enable multithreading within processes</li>
<li>How to configure process resources with <code>nextflow.config</code></li>
<li>How to enable and view Nextflow workflow reports</li>
</ol>
</div>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.56dfad97.min.js"></script>
      
    
  </body>
</html>